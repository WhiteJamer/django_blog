{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-10">
    {% if user == post.owner %}
        <a href="{% url 'postmanager:post_update' post.slug %}" class="btn btn-secondary mb-3">Edit</a>
      {% endif %}
      <p>
        {% for category in post.categories.all %}
          <a href="{{category.get_absolute_url}}" class="pr-3">{{category.name}}</a>
        {% endfor %}
      </p>
      <div class="post-detail_title">
        <h1 class="mb-5"><a href="{{post.get_absolute_url}}">{{post.title}}</a></h1>
      </div>
      {{post.content|safe}}
      <p class="mt-3">
        <small>{{post.created_at}}</small>
        <small><b><a href="{{post.owner.get_absolute_url}}">{{post.owner}}</a></b></small>
      </p>
      <h1 class="mt-3">Leave a comment!</h1>
      {% if user.is_authenticated %}
      <form action="{% url 'commentmanager:comment_add' post.slug %}" method="POST" class="form-group">
        {% csrf_token %}
        <textarea name="body" id="body" cols="30" rows="10" class="form-control"
                  placeholder="Write something..."></textarea>
        <button type="submit" class="btn btn-success form-control">Add Comment</button>
      </form>
      {% else%}
      <p>You need a <a href="{% url 'login' %}"><b>Log in</b></a> to leave comment.</p>
      {% endif %}

      {% if post.comments.count > 0 %}
      {% for comment in post.comments.all %}
      <div class="media center">
        <div class="mr-5 comment-avatar" style="background-image: url({{comment.owner.avatar.url}});"></div>
        <div class="media-body">
          <h3>{{comment.owner.username}}</h3>
          <p>{{comment.body}}</p>
          <p><small>{{comment.created_at}}</small></p>
          {% if user == comment.owner %}
            <form action="{% url 'commentmanager:comment_delete' comment.pk %}" method="POST">
              {% csrf_token %}
              <p><button href="#" class="btn btn-danger">Delete</button></p>
            </form>
          {% endif %}
        </div>
      </div>
      {% endfor %}
      {% else %}
      <p><b>Comments not found :(</b></p>
      {% endif %}
  </div>
</div>

{% endblock %}